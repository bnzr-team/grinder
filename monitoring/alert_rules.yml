groups:
  - name: grinder_critical
    rules:
      - alert: GrinderEmergencyExit
        expr: grinder_state == 6
        for: 0m
        labels:
          severity: critical
        annotations:
          summary: "GRINDER emergency exit triggered"
          description: "System entered emergency state"

      - alert: GrinderHighDrawdown
        expr: grinder_drawdown_pct{period="daily"} > 0.08
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Daily drawdown exceeds 8%"
          description: "Current drawdown: {{ $value | humanizePercentage }}"

      - alert: GrinderKillSwitchTriggered
        expr: grinder_kill_switch_triggered == 1
        for: 0m
        labels:
          severity: critical
        annotations:
          summary: "Kill switch has been triggered"
          description: "Manual intervention required"

  - name: grinder_warning
    rules:
      - alert: GrinderHighToxicity
        expr: grinder_toxicity_score > 2.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High toxicity for {{ $labels.symbol }}"
          description: "Toxicity score: {{ $value }}"

      - alert: GrinderDataStale
        expr: grinder_data_staleness_ms > 5000
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Stale data for {{ $labels.stream }}"
          description: "Data staleness: {{ $value }}ms"

      - alert: GrinderHighLatency
        expr: histogram_quantile(0.99, rate(grinder_order_latency_ms_bucket[5m])) > 500
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "P99 order latency exceeds 500ms"
          description: "Current P99: {{ $value }}ms"

      - alert: GrinderConsecutiveLosses
        expr: grinder_consecutive_losses > 4
        for: 0m
        labels:
          severity: warning
        annotations:
          summary: "Consecutive losing trades"
          description: "{{ $value }} consecutive losses"

      - alert: GrinderInventoryHigh
        expr: abs(grinder_inventory_notional_usd) > 4000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High inventory for {{ $labels.symbol }}"
          description: "Inventory: ${{ $value }}"

  - name: grinder_info
    rules:
      - alert: GrinderStateChange
        expr: changes(grinder_state[5m]) > 3
        for: 0m
        labels:
          severity: info
        annotations:
          summary: "Frequent state changes"
          description: "{{ $value }} state changes in 5 minutes"

      - alert: GrinderLowFillRate
        expr: grinder_fill_rate < 0.3
        for: 10m
        labels:
          severity: info
        annotations:
          summary: "Low fill rate for {{ $labels.symbol }}"
          description: "Fill rate: {{ $value | humanizePercentage }}"

  - name: grinder_system
    rules:
      - alert: GrinderDown
        expr: up{job="grinder"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "GRINDER is down"
          description: "GRINDER instance is not responding"

      - alert: GrinderHighMemory
        expr: grinder_process_rss_mb > 1024
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage"
          description: "RSS: {{ $value }}MB"

      - alert: GrinderHighCPU
        expr: rate(grinder_process_cpu_seconds_total[5m]) > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage"
          description: "CPU usage: {{ $value | humanizePercentage }}"
